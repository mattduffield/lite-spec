<!DOCTYPE html>
<html lang="en" class="theme-royal dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LiteSpec</title>

  <style>
    .flex{display:flex}.block{display:block}.grid{display:grid}.col{display:flex;flex-direction:column}.col-1{display:flex;flex-direction:column;flex:1 1 0%}.row{display:flex;flex-direction:row}.flex-1{flex:1 1 0%}.flex-col{flex-direction:column}.flex-row{flex-direction:row}.flex-wrap{flex-wrap:wrap}.gap-2{gap:.5rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}.p-0{padding:0}.p-2{padding:.5rem}.p-3{padding:.75rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.pt-2{padding-top:.5rem}.pb-5{padding-bottom:1.25rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.h-10{height:2.5rem}.h-screen{height:100vh}.h-full{height:100%}.w-40{width:10rem}.self-center{align-self:center}.overflow-hidden{overflow:hidden}.hidden{display:none}@media (min-width: 640px){.sm\:flex{display:flex}.sm\:block{display:block}.sm\:hidden{display:none}}
  </style>
  <link href="https://mattduffield.github.io/wave-css/dist/wave-css.css" rel="stylesheet" type="text/css">
  <script>
    window.WcIconConfig = {
      bundleBaseUrl: 'https://mattduffield.github.io/wave-css/dist/assets/icon-bundles',
      // Preload these bundles automatically
      preloadBundles: ['solid', 'duotone', 'regular']
    };
  </script>
  <script type="module" src="https://mattduffield.github.io/wave-css/dist/wave-css.js"></script>
  <script src="https://mattduffield.github.io/wave-css/dist/wave-helpers.js"></script>
  <script src="dist/lite-spec.js"></script>

  <style>
    #background-content {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: -1;
      pointer-events: none;
    }
    wc-javascript {
      display: none;
    }
  </style>
</head>
<body class="flex flex-col flex-1">

  <div id="background-content"></div>
  <main id="viewport" class="slide-it">
    <wc-tab-container>
      <wc-tab-item label="Schema">
        <div class="flex flex-wrap flex-1 gap-2 pt-2 pb-5 px-5">
          <div class="flex flex-col flex-1 overflow-hidden">
            <div class="flex flex-row flex-1">
              <wc-code-mirror
                name="schema"
                lbl-label="LiteSpec Schema"
                height="600px"
                line-numbers
                line-wrapper
                fold-gutter
                mode="litespec"
                theme="monokai"
                value=""
                tab-size="2"
                indent-unit="2"
                required></wc-code-mirror>
            </div>
          </div>

          <button id="go"
                  class="h-10 self-center"
                  type="button"
                  onclick="generate()">
            Go
          </button>

          <div class="flex flex-col flex-1">
            <div class="flex flex-1 overflow-hidden">
              <wc-code-mirror
                name="json_schema"
                lbl-label="JSON Schema"
                height="600px"
                line-numbers
                line-wrapper
                fold-gutter
                mode="javascript"
                theme="monokai"
                value=""
                tab-size="2"
                indent-unit="2"
                required></wc-code-mirror>
            </div>
          </div>
        </div>
      </wc-tab-item>

      <wc-tab-item label="Examples">
        <div class="flex flex-col gap-4 p-6">
          <h2>LiteSpec Examples</h2>
          <div class="flex flex-col gap-3">
            <button class="btn btn-primary" onclick="loadExample('customer')">Load Customer Example</button>
            <button class="btn btn-primary" onclick="loadExample('pattern')">Load Pattern Example</button>
            <button class="btn btn-primary" onclick="loadExample('conditional')">Load Conditional Validation Example</button>
            <button class="btn btn-primary" onclick="loadExample('cross-reference')">Load Cross-Reference Example</button>
          </div>
        </div>
      </wc-tab-item>

      <wc-tab-item label="About">
        <div class="flex flex-col gap-4 p-6">
          <h2>About LiteSpec</h2>
          <p>LiteSpec is a domain-specific language that converts clean, intuitive syntax to JSON Schema.</p>
          <p>Features:</p>
          <ul>
            <li>Simple, readable syntax for defining schemas</li>
            <li>Support for objects, arrays, and nested types</li>
            <li>Built-in validation rules and constraints</li>
            <li>Conditional validation with @if directives</li>
            <li>Pattern matching with regex</li>
            <li>Reference definitions with @ref</li>
            <li>Permission controls with @can</li>
          </ul>
        </div>
      </wc-tab-item>
    </wc-tab-container>
  </main>

  <footer id="baseFooter">
    <p>Â© 2026 LiteSpec</p>
  </footer>

  <div id="modal-container"></div>

  <wc-event-hub></wc-event-hub>
  <wc-mask-hub></wc-mask-hub>
  <wc-prompt></wc-prompt>
  <wc-notify></wc-notify>
  <wc-theme></wc-theme>

  <script src="/static/js/htmx.org@2.0.6.js"></script>
  <script src="/static/js/hyperscript.org@0.9.14.js"></script>

  <script src="/static/js/field-rules.js"></script>
  <script src="/static/js/field-rules-manager.js"></script>

  <script>
    htmx.config.selfRequestsOnly = false;
    htmx.config.allowedDomains = ['localhost:3016', '127.0.0.1:3016'];

    document.body.addEventListener('htmx:responseError', (e) => {
      const error = e.detail.xhr.response;
      wc.prompt.error({
        title: 'Error',
        text: error,
        callback: (result) => {
          // Handle result
        }
      });
    });
  </script>

  <script>
    // Example schemas
    const examples = {
      customer: `// Example LiteSpec Schema
def Address object {
  street: string @required
  city: string @required
  state: string @required @pattern(^[A-Z]{2}$)
  postal_code: string @required @pattern(^\\d{5}(-\\d{4})?$)
}

def Member array {
  first_name: string @required @minLength(2) @maxLength(50)
  middle_initial: string @minLength(1) @maxLength(1)
  last_name: string @required @minLength(2) @maxLength(50)
  age: integer @minimum(0) @maximum(130)

  @if(first_name: @minLength(2) @maxLength(99), @required(middle_initial) @required(last_name))
}

model Customer object {
  _id: string @required
  first_name: string @required @minLength(2) @maxLength(50)
  last_name: string @required @minLength(2) @maxLength(50)
  email: string @required @pattern(^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$)
  age: integer @minimum(14) @exclusiveMaximum(130)
  gender: string @required @enum(male,female,other)
  address: object @ref(Address) @required
  household_members: array @ref(Member) @minItems(1) @uniqueItems
  tags: array(string) @uniqueItems
  salary: number @minimum(30000) @maximum(999999)
  has_prior_coverage: boolean @required @default(false)
  prior_coverage_company: string @minLength(2)
  is_active: boolean @required @default(true)
  created_date: string @format(date-time)
  modified_date: string @format(date-time)

  @if(has_prior_coverage: @const(true), @required(prior_coverage_company))
  @if(age: @minimum(18), @required(salary))
}`,
      pattern: `// Example demonstrating @pattern usage in LiteSpec
// Patterns use standard regex syntax for string validation

model User object {
  // Username: 3-16 alphanumeric characters or underscore
  username: string @required @pattern(^[a-zA-Z0-9_]{3,16}$)

  // Email format validation
  email: string @pattern(^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$)

  // US Phone number format: 555-123-4567
  phone: string @pattern(^\\d{3}-\\d{3}-\\d{4}$)

  // US ZIP code: 5 digits or ZIP+4 format
  zipcode: string @pattern(^\\d{5}(-\\d{4})?$)

  // URL starting with http or https
  website: string @pattern(^https?://[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$)

  // Hex color code
  favorite_color: string @pattern(^#[0-9A-Fa-f]{6}$)

  // IPv4 address
  ip_address: string @pattern(^(\\d{1,3}\\.){3}\\d{1,3}$)

  // Complex pattern with alternation and optional parts
  status: string @pattern(^(active|inactive|pending)(-(verified|unverified))?$)
}`,
      conditional: `// Example demonstrating conditional validation with nested properties

def Quote object {
  insurance_type: string @required @enum(auto,motorcycle,home,life)
}

def Vehicle object {
  make: string @required
  model: string @required
  year: string @required
}

model Prospect object {
  quote: object @ref(Quote) @required
  household_vehicles: array(@ref(Vehicle)) @uniqueItems

  // Conditional validation: require at least 1 vehicle for auto/motorcycle insurance
  @if(quote.insurance_type: @enum(auto,motorcycle), @minItems(household_vehicles,1))

  // Can also chain multiple conditions for different insurance types
  // @if(quote.insurance_type: @enum(home), @required(property_address))
}`,
      'cross-reference': `// Cross-reference validation example

def Department object {
  _id: string @required
  name: string @required
  budget: number @minimum(0)
}

model Employee object {
  _id: string @required
  first_name: string @required
  last_name: string @required
  department_id: string @required
  manager_id: string

  @can(view: "@self admin hr", add: "admin hr", edit: "admin hr @self", delete: "admin")
}`
    };

    // Generate JSON Schema from LiteSpec
    function generate() {
      try {
        const schemaEditor = document.querySelector('wc-code-mirror[name="schema"]');
        const jsonSchemaEditor = document.querySelector('wc-code-mirror[name="json_schema"]');

        const litespecCode = schemaEditor.value;

        if (!litespecCode || !litespecCode.trim()) {
          wc.notify.warning('Please enter some LiteSpec code first!');
          return;
        }

        // Use the parseDSL function from lite-spec.js
        const jsonSchema = window.litespec.parseDSL(litespecCode, false);

        // Pretty print the JSON
        const formattedJson = JSON.stringify(jsonSchema, null, 2);
        jsonSchemaEditor.value = formattedJson;

        wc.notify.success('JSON Schema generated successfully!');
      } catch (error) {
        wc.prompt.error({
          title: 'Parse Error',
          text: 'Error parsing LiteSpec: ' + error.message
        });
        console.error('Parse error:', error);
      }
    }

    // Load example
    function loadExample(exampleName) {
      const schemaEditor = document.querySelector('wc-code-mirror[name="schema"]');
      const jsonSchemaEditor = document.querySelector('wc-code-mirror[name="json_schema"]');

      if (examples[exampleName]) {
        schemaEditor.value = examples[exampleName];
        jsonSchemaEditor.value = '';

        // Switch to the Schema tab
        const tabContainer = document.querySelector('wc-tab-container');
        if (tabContainer) {
          tabContainer.activeTab = 0;
        }

        wc.notify.success('Example loaded! Click "Go" to generate JSON Schema.');
      }
    }

    // Initialize with customer example on page load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        requestAnimationFrame(() => {
          requestAnimationFrame(() => {
            document.body.classList.add('wave-ready');
            //loadExample('customer');
          });
        });
      });
    } else {
      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          document.body.classList.add('wave-ready');
          //loadExample('customer');
        });
      });
    }
  </script>
 
</body>
</html>
